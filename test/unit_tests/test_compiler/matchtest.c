#include "yats.h"
#include "matchtest.h"

SETUP_YATS();

static void test_simple() {
	unsigned char expected[] = {
		0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x7D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		C_INT_1, 1,
		C_STR,
		0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		'o', 'n', 'e',
		C_STR,
		0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		'n', 'o', 't', ' ', 'o', 'n', 'e',
		O_LIT, 0x00,
		O_LLOAD, 0x00,
		O_MATCH,
		0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x25, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		P_INT,
		0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		O_LIT, 0x01,
		O_ECHO,
		O_BR_8,
		0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		P_ANY,
		O_LIT, 0x02,
		O_ECHO,
		O_HALT
	};
	ASSERT_GEN_BC_EQ(expected, "let x = 1; match x { 1 { echo 'one'; }; * { echo 'not one'; }; };");
}

int matchtest(void) {
	test_simple();

	return __YASL_TESTS_FAILED__;
}
